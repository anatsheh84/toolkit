<!-- INTERNAL TABLE FOR BGP ADDRESS FAMILY -->
<div id="accordion">
<div>
<h3>BGP Address Family</h3>
<div class="net_content">
{% if hostvars[network_switch]['ansible_network_resources']['bgp_address_family']['address_family'] is defined and hostvars[network_switch]['ansible_network_resources']['bgp_address_family']['address_family']|length > 0 %}

{% for address_family in hostvars[network_switch]['ansible_network_resources']['bgp_address_family']['address_family'] %}
<p class="internal_label">Address Family {{ address_family['afi']|default('ipv4') }}</p>

{# Networks Table #}
{% if address_family['networks'] is defined and address_family['networks']|length > 0 %}
<table id="subtable">
    <thead>
        <tr>
            <th>Network</th>
            <th>Mask</th>
        </tr>
    </thead>
    <tbody>
    {% for bgp_network in address_family['networks'] %}
        <tr>
            <td>{{ bgp_network['address']|default("Not Configured") }}</td>
            <td>{{ bgp_network['mask']|default("Not Configured") }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

{# Neighbors Activation Table #}
{% if address_family['neighbors'] is defined and address_family['neighbors']|length > 0 %}
<p class="internal_label">Activated Neighbors</p>
<table id="subtable">
    <thead>
        <tr>
            <th>Neighbor Address</th>
            <th>Activate</th>
            <th>Route Reflector Client</th>
        </tr>
    </thead>
    <tbody>
    {% for neighbor in address_family['neighbors'] %}
        <tr>
            <td>{{ neighbor['neighbor_address']|default("Not Configured") }}</td>
            <td>
                {% if neighbor['activate'] is defined %}
                    {% if neighbor['activate'] %}
                        <span style="color: green;">Yes</span>
                    {% else %}
                        <span style="color: red;">No</span>
                    {% endif %}
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>{{ neighbor['route_reflector_client']|default("No") }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

{# Redistribution Information #}
{% if address_family['redistribute'] is defined and address_family['redistribute']|length > 0 %}
<p class="internal_label">Redistribution</p>
<table id="subtable">
    <thead>
        <tr>
            <th>Protocol</th>
            <th>Process/Details</th>
        </tr>
    </thead>
    <tbody>
    {% for redist in address_family['redistribute'] %}
        <tr>
            {% if redist['ospf'] is defined %}
                <td>OSPF</td>
                <td>Process ID: {{ redist['ospf']['process_id']|default("N/A") }}</td>
            {% elif redist['static'] is defined %}
                <td>Static</td>
                <td>Enabled</td>
            {% elif redist['connected'] is defined %}
                <td>Connected</td>
                <td>Enabled</td>
            {% elif redist['eigrp'] is defined %}
                <td>EIGRP</td>
                <td>AS: {{ redist['eigrp']['as_number']|default("N/A") }}</td>
            {% elif redist['isis'] is defined %}
                <td>IS-IS</td>
                <td>{{ redist['isis']['area_tag']|default("Enabled") }}</td>
            {% else %}
                <td>Unknown</td>
                <td>{{ redist }}</td>
            {% endif %}
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

{% endfor %}

{% elif hostvars[network_switch]['ansible_network_resources']['bgp_address_family']['address_family'] is defined and hostvars[network_switch]['ansible_network_resources']['bgp_address_family']['address_family']|length == 0 %}
No BGP address-family is configured on this device
{% else %}
No BGP address family information available
{% endif %}
</div>
</div>
</div>
<!-- END INTERNAL TABLE FOR BGP ADDRESS FAMILY -->
