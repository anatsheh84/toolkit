<!-- INTERNAL TABLE FOR INTERFACES -->
<div id="accordion">
<div>
<h3>Interfaces - Admin Status/Operational Status/MTU/Duplex/Speed</h3>
<div class="net_content">
{% if hostvars[network_switch]['ansible_network_resources']['interfaces'] is defined and hostvars[network_switch]['ansible_network_resources']['interfaces']|length > 0  %}
<table id="subtable">
    <thead>
        <tr>
            <th>Interface Name</th>
            <th>Description</th>
            <th>Admin Status</th>
            <th>Operational Status</th>
            <th>Protocol Status</th>
            <th>IP Address</th>
            <th>Duplex</th>
            <th>MTU</th>
            <th>Speed</th>
        </tr>
    </thead>
    <tbody>
{% for interface in hostvars[network_switch]['ansible_network_resources']['interfaces'] %}
        <tr>
            <td>{{interface['name']}}</td>
            <td>{{interface['description']|default("none")}}</td>
            <td>
                {% if interface['enabled'] %}
                <span style="color: green; font-weight: bold;">UP</span>
                {% else %}
                <span style="color: red; font-weight: bold;">DOWN</span>
                {% endif %}
            </td>
            
            <!-- Operational Status, Protocol Status, and IP Address -->
            {% set oper_found = false %}
            {% set oper_status = 'N/A' %}
            {% set proto_status = 'N/A' %}
            {% set ip_addr = 'N/A' %}
            
            {% if hostvars[network_switch]['operational_status_data'] is defined %}
                {% for status in hostvars[network_switch]['operational_status_data'] %}
                    {% set status_interface = status[0]|lower|replace(' ', '') %}
                    {% set current_interface = interface['name']|lower|replace(' ', '') %}
                    {% if status_interface == current_interface %}
                        {% set oper_status = status[2]|upper %}
                        {% set proto_status = status[3]|upper %}
                        {% set ip_addr = status[1] if status[1] != 'unassigned' else 'N/A' %}
                        {% set oper_found = true %}
                    {% endif %}
                {% endfor %}
            {% endif %}
            
            {% if not oper_found and hostvars[network_switch]['interface_status'] is defined and 
                  hostvars[network_switch]['interface_status'][interface['name']] is defined %}
                {% set iface_data = hostvars[network_switch]['interface_status'][interface['name']] %}
                {% if iface_data['operstatus'] is defined %}
                    {% set oper_status = iface_data['operstatus']|upper %}
                {% endif %}
                {% if iface_data['lineprotocol'] is defined %}
                    {% set proto_status = iface_data['lineprotocol']|upper %}
                {% endif %}
                {% if iface_data['ipv4'] is defined and iface_data['ipv4']|length > 0 %}
                    {% set ip_addr = iface_data['ipv4'][0]['address'] ~ '/' ~ iface_data['ipv4'][0]['subnet'] %}
                {% endif %}
            {% endif %}
            
            <!-- Display Operational Status -->
            <td>
                {% if oper_status == 'UP' %}
                <span style="color: green; font-weight: bold;">{{ oper_status }}</span>
                {% elif oper_status == 'DOWN' %}
                <span style="color: red; font-weight: bold;">{{ oper_status }}</span>
                {% elif 'ADMIN' in oper_status %}
                <span style="color: orange; font-weight: bold;">{{ oper_status }}</span>
                {% else %}
                <span style="color: gray;">{{ oper_status }}</span>
                {% endif %}
            </td>
            
            <!-- Display Protocol Status -->
            <td>
                {% if proto_status == 'UP' %}
                <span style="color: green; font-weight: bold;">{{ proto_status }}</span>
                {% elif proto_status == 'DOWN' %}
                <span style="color: red; font-weight: bold;">{{ proto_status }}</span>
                {% else %}
                <span style="color: gray;">{{ proto_status }}</span>
                {% endif %}
            </td>
            
            <!-- Display IP Address -->
            <td>{{ ip_addr }}</td>
            
            <!-- Display Duplex, MTU, Speed -->
            <td>{{interface['duplex']|default("default")}}</td>
            <td>{{interface['mtu']|default("default")}}</td>
            <td>{{interface['speed']|default("default")}}</td>
        </tr>
{% endfor %}
    </tbody>
</table>

<!-- Interface Status Summary -->
{% set total_interfaces = hostvars[network_switch]['ansible_network_resources']['interfaces'] | length %}
{% set admin_up = hostvars[network_switch]['ansible_network_resources']['interfaces'] | selectattr('enabled', 'equalto', true) | list | length %}
{% set admin_down = total_interfaces - admin_up %}

<!-- Calculate operational status counts -->
{% set ns = namespace(oper_up=0, oper_down=0, proto_up=0, proto_down=0) %}
{% if hostvars[network_switch]['operational_status_data'] is defined %}
    {% for status in hostvars[network_switch]['operational_status_data'] %}
        {% if status[2]|lower == 'up' %}
            {% set ns.oper_up = ns.oper_up + 1 %}
        {% else %}
            {% set ns.oper_down = ns.oper_down + 1 %}
        {% endif %}
        {% if status[3]|lower == 'up' %}
            {% set ns.proto_up = ns.proto_up + 1 %}
        {% else %}
            {% set ns.proto_down = ns.proto_down + 1 %}
        {% endif %}
    {% endfor %}
{% elif hostvars[network_switch]['interface_status'] is defined %}
    {% for iface_name, iface_data in hostvars[network_switch]['interface_status'].items() %}
        {% if iface_data['operstatus'] is defined %}
            {% if iface_data['operstatus']|lower == 'up' %}
                {% set ns.oper_up = ns.oper_up + 1 %}
            {% else %}
                {% set ns.oper_down = ns.oper_down + 1 %}
            {% endif %}
        {% endif %}
        {% if iface_data['lineprotocol'] is defined %}
            {% if iface_data['lineprotocol']|lower == 'up' %}
                {% set ns.proto_up = ns.proto_up + 1 %}
            {% else %}
                {% set ns.proto_down = ns.proto_down + 1 %}
            {% endif %}
        {% endif %}
    {% endfor %}
{% endif %}

<div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px;">
    <strong>Interface Summary:</strong>
    Total: {{ total_interfaces }} | 
    Admin UP: <span style="color: green;">{{ admin_up }}</span> | 
    Admin DOWN: <span style="color: red;">{{ admin_down }}</span>
    {% if ns.oper_up > 0 or ns.oper_down > 0 %}
    | Operationally UP: <span style="color: green;">{{ ns.oper_up }}</span> | 
    Operationally DOWN: <span style="color: red;">{{ ns.oper_down }}</span>
    {% endif %}
    {% if ns.proto_up > 0 or ns.proto_down > 0 %}
    | Protocol UP: <span style="color: green;">{{ ns.proto_up }}</span> | 
    Protocol DOWN: <span style="color: red;">{{ ns.proto_down }}</span>
    {% endif %}
</div>

{% elif hostvars[network_switch]['ansible_network_resources']['interfaces'] is defined and hostvars[network_switch]['ansible_network_resources']['interfaces']|length == 0 %}
No interfaces configured on this device
{% else %}
No Interface information available
{% endif %}
</div>
</div>
</div>
<!-- END INTERNAL TABLE FOR INTERFACES -->
